# Listing of Parameters
# ---------------------
# Number of dimensions
set dimension = 2

set test_type = boundary_layer_mesh_optimization
set pde_type  = advection

set conv_num_flux = lax_friedrichs
set diss_num_flux = symm_internal_penalty

# DG related parameters
set overintegration = 8
set use_weak_form = true
# set flux_nodes_type = GL


subsection ODE solver
  set output_solution_every_x_steps = 1

  # Maximum nonlinear solver iterations
  set nonlinear_max_iterations            = 100

  # Nonlinear solver residual tolerance
  set nonlinear_steady_residual_tolerance = 1e-11

  set initial_time_step = 0.1
  set time_step_factor_residual = 1.0
  set time_step_factor_residual_exp = 1.0

  # Print every print_iteration_modulo iterations of the nonlinear solver
  # set print_iteration_modulo              = 1

  # Explicit or implicit solverChoices are <explicit|implicit>.
  set ode_solver_type                         = implicit
end

subsection linear solver
#set linear_solver_type = direct
#set linear_solver_output = verbose
  subsection gmres options
    # Factor by which the diagonal of the matrix will be scaled, which
    # sometimes can help to get better preconditioners
    set ilut_atol                 = 1e-4

    # Amount of an absolute perturbation that will be added to the diagonal of
    # the matrix, which sometimes can help to get better preconditioners
    set ilut_rtol                 = 1.00001

    # relative size of elements which should be dropped when forming an
    # incomplete lu decomposition with threshold
    set ilut_drop                 = 0.0
    # Amount of additional fill-in elements besides the sparse matrix
    # structure
    set ilut_fill                 =  2

    # Linear residual tolerance for convergence of the linear system
    set linear_residual_tolerance = 1e-10

    # Maximum number of iterations for linear solver
    set max_iterations            = 2000

    # Number of iterations before restarting GMRES
    set restart_number            = 300

  end 
end

subsection functional
    # functional choice
    set functional_type = normLp_boundary

    # exponent
    set normLp = 1.0

    # boundaries to be used
    set boundary_vector = [1,2]
    set use_all_boundaries = false
  end

subsection optimization
    set optimization_type = full_space

    set gradient_tolerance = 1.0e-10 
    set max_design_cycles = 500
    set linear_iteration_limit = 700
    set initial_step_size = 1.0
    set functional_evaluation_limit = 30
    set line_search_method = Backtracking
    set line_search_curvature = Null Curvature Condition
    set full_space_preconditioner = P2A
    set mesh_weight_factor = 0.2 #0.5

    set regularization_parameter_control = 1.0
    set regularization_parameter_sim = 1.0
    set regularization_scaling = 2.0
    set regularization_tol_low = 1.0e-2
    set regularization_tol_high = 1.0e-1
end

subsection flow_solver
  set flow_case_type = non_periodic_cube_flow
  set steady_state = true
  set poly_degree = 1
  set max_poly_degree_for_adaptation = 3

  subsection grid
    set number_of_mesh_refinements = 5
    end
end


subsection manufactured solution convergence study
  set use_manufactured_source_term = true
  set manufactured_solution_type   = boundary_layer_solution

  # setting the default diffusion tensor
  set diffusion_00 = 1
  set diffusion_01 = 0
  set diffusion_10 = 0
  set diffusion_11 = 1

  # setting the advection vector
  set advection_0 = 1
  set advection_1 = -1 

  # setting the diffusion coefficient
  set diffusion_coefficient = 0.1
  
end

subsection mesh adaptation
  set total_mesh_adaptation_cycles = 20
  set mesh_adaptation_type = anisotropic_adaptation
  set use_goal_oriented_mesh_adaptation = false
  subsection anisotropic
    set mesh_complexity_anisotropic_adaptation = 15
    set norm_Lp_anisotropic_adaptation = 1
  end
end
